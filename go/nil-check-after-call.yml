rules:
- id: nil-check-after-call
  patterns:
    - pattern-either:
        - pattern: |
            $FOO.$BAR(...)
            ...
            if $FOO != nil { ... }
        - pattern: |
            $FOO.$BAR(...)
            ...
            if $FOO == nil { ... }
    - pattern-not: |
       $FOO.$BAR(...)
       ...
       $FOO = ...
       ...
       if $FOO != nil { ... }
    - pattern-not: |
       $FOO.$BAR(...)
       ...
       ..., $FOO, ... = ...
       ...
       if $FOO == nil { ... }
    - pattern-not: |
       $FOO.$BAR(...)
       ...
       ..., $FOO, ... = ...
       ...
       if $FOO != nil { ... }
    - pattern-not: |
       $FOO.$BAR(...)
       ...
       $FOO = ...
       ...
       if $FOO == nil { ... }
    - pattern-not: |
        ..., $FOO = $FOO.$BAR(...)
        ...
        if $FOO == nil { ... }
    - pattern-not: |
        ..., $FOO = $FOO.$BAR(...)
        ...
        if $FOO != nil { ... }
    - pattern-not: |
        $FOO = $FOO.$BAR(...)
        ...
        if $FOO == nil { ... }
    - pattern-not: |
        $FOO = $FOO.$BAR(...)
        ...
        if $FOO != nil { ... }

  message: Potential `$FOO` nil dereference when `$BAR` is called
  languages: [go]
  severity: ERROR
